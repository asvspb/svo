# CI/CD Guide

## Обязательные проверки
- Форматирование: black, isort
- Линтинг: ruff/flake8
- Типы: mypy/pyright
- Тесты: pytest + coverage

## Политики PR
- Блокирующие статусы: все проверки должны быть зелены.
- Минимум 1 ревьюера; нет запроса — нет мержа.
- Небольшие, атомарные PR; changelog и описание изменений.

## Релизы и версии
- Теги релизов, автоматическая генерация changelog (Keep a Changelog/Conventional Commits).
- Публикация артефактов (отчеты, данные) в CI.

## Playwright в CI
- Устанавливайте браузеры: `playwright install --with-deps chromium` (Linux) и используйте `xvfb-run` при headless-тестах.
- Разделяйте быстрые юнит-тесты и медленные e2e по джобам; e2e запускайте по расписанию/по лейблу.
- Кэшируйте `~/.cache/ms-playwright` между сборками.

## Гео-стек в CI
- Кэшируйте зависимости (geopandas/shapely) и системные либы (GEOS/GDAL/PROJ).
- Явно указывайте версии для воспроизводимости; прогревайте колёса, если возможно.

## Секреты и окружения
- Telegram токен и административные ID — через секреты CI; не логируйте их в явном виде.
- Профили окружений (`dev/test/prod`) — через переменные окружения и .env файлы в секретном хранилище.

## Автоматизация и расписание
- Используйте расписания (cron) для ночных прогонов скрапера и генерации отчётов.
- Публикуйте скриншоты/артефакты (например, изменений на карте) как артефакты сборки.

## Локальная автоматизация
- pre-commit для локального форматирования/линтинга/типизации перед коммитом.
- Dependabot/pyup для обновления зависимостей и безопасности.
